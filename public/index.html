<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DSQ Outlook Taskpane new</title>
<script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
<style>
  body { font-family: Arial; margin: 10px; font-size: 13px; }
  label { display:block; margin-top:8px; }
  input, select, textarea, button { margin-top:4px; padding:4px; width:100%; box-sizing:border-box; }
  table { width:100%; border-collapse: collapse; margin-top:12px; }
  table, th, td { border:1px solid #999; }
  th, td { padding:6px; text-align:left; font-size:12px; }
</style>
</head>
<body>

<h3>DSQ Request Form</h3>

<label>Account Number</label>
<input type="text" id="accountNumber" placeholder="Enter account number">

<label>Account Name</label>
<input type="text" id="accountName" placeholder="Enter account name">

<label>Msisdns (comma separated)</label>
<input type="text" id="msisdns" placeholder="Enter MSISDNs">

<label>Modification Type</label>
<select id="modType">
  <option value="">--Select--</option>
  <option value="S.L">S.L</option>
  <option value="Plan change">Plan change</option>
  <option value="Addon">Addon</option>
  <option value="Sim swap">Sim swap</option>
  <option value="TON">TON</option>
</select>

<div id="dynamicInputContainer"></div>

<label>Comments</label>
<textarea id="comments" rows="3" placeholder="Enter comments"></textarea>

<button id="generateBtn">Generate Table</button>
<button id="emailBtn">Email</button>

<table id="outputTable">
  <thead>
    <tr>
      <th>Account number/Sample #</th>
      <th>Account name</th>
      <th>Msisdn(s)</th>
      <th>Sim serial(s)</th>
      <th>S.L</th>
      <th>Modification</th>
      <th>Extras/Addons</th>
      <th>Request Type</th>
      <th>Comments</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>---</td>
      <td>---</td>
      <td>---</td>
      <td>---</td>
      <td>---</td>
      <td>---</td>
      <td>---</td>
      <td>---</td>
      <td>---</td>
    </tr>
  </tbody>
</table>

<script>
Office.onReady(() => {
  const modType = document.getElementById('modType');
  const dynamicContainer = document.getElementById('dynamicInputContainer');

  let extraInput = null;

  // Show dynamic input based on dropdown selection
  modType.addEventListener('change', () => {
    dynamicContainer.innerHTML = '';
    extraInput = null;
    const val = modType.value;
    if(val) {
      const label = document.createElement('label');
      label.textContent = val + ':';
      const input = document.createElement('input');
      input.type = 'text';
      input.id = 'extraField';
      input.placeholder = 'Enter ' + val;
      dynamicContainer.appendChild(label);
      dynamicContainer.appendChild(input);
      extraInput = input;
    }
  });

  // Generate table values
  document.getElementById('generateBtn').addEventListener('click', () => {
    const accountNumber = document.getElementById('accountNumber').value || '---';
    const accountName = document.getElementById('accountName').value || '---';
    const msisdns = document.getElementById('msisdns').value || '---';
    const comments = document.getElementById('comments').value || '---';
    const modSelection = modType.value || '---';
    const extraVal = extraInput ? extraInput.value || '---' : '---';

    const simSerial = modSelection === 'Sim swap' ? extraVal : '---';
    const slVal = modSelection === 'S.L' ? extraVal : '---';
    const planChange = modSelection === 'Plan change' ? extraVal : '---';
    const addonVal = modSelection === 'Addon' ? extraVal : '---';
    const tonVal = modSelection === 'TON' ? extraVal : '---';

    const tbody = document.querySelector('#outputTable tbody');
    tbody.innerHTML = `
      <tr>
        <td>${accountNumber}</td>
        <td>${accountName}</td>
        <td>${msisdns}</td>
        <td>${simSerial}</td>
        <td>${slVal}</td>
        <td>${planChange}</td>
        <td>${addonVal}</td>
        <td>${modSelection}</td>
        <td>${comments}</td>
      </tr>
    `;
  });

  // Email button using correct Office.js API
  document.getElementById('emailBtn').addEventListener('click', () => {
    const comments = document.getElementById('comments').value || '---';
    const tableHtml = document.getElementById('outputTable').outerHTML;

    const bodyHtml = `
      <p>Hi team,</p>
      <p>Please action the below:</p>
      <p>${comments}</p>
      ${tableHtml}
    `;

    Office.context.mailbox.displayNewMessageForm({
      toRecipients: ['qv@covalenseglobal.com'],
      subject: 'DSQ Request',
      htmlBody: bodyHtml
    });
  });
});
</script>

</body>
</html>


<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DSQ Outlook Taskpane new</title>
<script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
<style>
  body { font-family: Arial; margin: 10px; font-size: 13px; }
  label { display:block; margin-top:8px; }
  input, select, textarea, button { margin-top:4px; padding:4px; width:100%; box-sizing:border-box; }
  table { width:100%; border-collapse: collapse; margin-top:12px; }
  table, th, td { border:1px solid #999; }
  th, td { padding:6px; text-align:left; font-size:12px; }
</style>
</head>
<body>

<h3>DSQ Request Form</h3>

<label>Account Number</label>
<input type="text" id="accountNumber" placeholder="Enter account number">

<label>Account Name</label>
<input type="text" id="accountName" placeholder="Enter account name">

<label>Msisdns (comma separated)</label>
<input type="text" id="msisdns" placeholder="Enter MSISDNs">

<label>Modification Type</label>
<select id="modType">
  <option value="">--Select--</option>
  <option value="S.L">S.L</option>
  <option value="Plan change">Plan change</option>
  <option value="Addon">Addon</option>
  <option value="Sim swap">Sim swap</option>
  <option value="TON">TON</option>
</select>

<div id="dynamicInputContainer"></div>

<label>Comments</label>
<textarea id="comments" rows="3" placeholder="Enter comments"></textarea>

<button id="generateBtn">Generate Table</button>
<button id="emailBtn">Email</button>

<table id="outputTable">
  <thead>
    <tr>
      <th style="background-color: yellow; font-weight:bold;">Account number/Sample #</th>
      <th style="background-color: yellow; font-weight:bold;">Account name</th>
      <th style="background-color: yellow; font-weight:bold;">Msisdn(s)</th>
      <th style="background-color: yellow; font-weight:bold;">Sim serial(s)</th>
      <th style="background-color: yellow; font-weight:bold;">S.L</th>
      <th style="background-color: yellow; font-weight:bold;">Modification</th>
      <th style="background-color: yellow; font-weight:bold;">Extras/Addons</th>
      <th style="background-color: yellow; font-weight:bold;">Request Type</th>
      <th style="background-color: yellow; font-weight:bold;">Comments</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>---</td>
      <td>---</td>
      <td>---</td>
      <td>---</td>
      <td>---</td>
      <td>---</td>
      <td>---</td>
      <td>---</td>
      <td>---</td>
    </tr>
  </tbody>
</table>

<script>
Office.onReady(() => {
  const modType = document.getElementById('modType');
  const dynamicContainer = document.getElementById('dynamicInputContainer');
  let extraInput = null;

  modType.addEventListener('change', () => {
    dynamicContainer.innerHTML = '';
    extraInput = null;
    const val = modType.value;
    if(val) {
      const label = document.createElement('label');
      label.textContent = val + ':';
      const input = document.createElement('input');
      input.type = 'text';
      input.id = 'extraField';
      input.placeholder = 'Enter ' + val;
      dynamicContainer.appendChild(label);
      dynamicContainer.appendChild(input);
      extraInput = input;
    }
  });

  document.getElementById('generateBtn').addEventListener('click', () => {
    const accountNumber = document.getElementById('accountNumber').value || '---';
    const accountName = document.getElementById('accountName').value || '---';
    const msisdns = document.getElementById('msisdns').value || '---';
    const comments = document.getElementById('comments').value || '---';
    const modSelection = modType.value || '---';
    const extraVal = extraInput ? extraInput.value || '---' : '---';

    const simSerial = modSelection === 'Sim swap' ? extraVal : '---';
    const slVal = modSelection === 'S.L' ? extraVal : '---';
    const planChange = modSelection === 'Plan change' ? extraVal : '---';
    const addonVal = modSelection === 'Addon' ? extraVal : '---';
    const tonVal = modSelection === 'TON' ? extraVal : '---';

    const tbody = document.querySelector('#outputTable tbody');
    tbody.innerHTML = `
      <tr>
        <td>${accountNumber}</td>
        <td>${accountName}</td>
        <td>${msisdns}</td>
        <td>${simSerial}</td>
        <td>${slVal}</td>
        <td>${planChange}</td>
        <td>${addonVal}</td>
        <td>${modSelection}</td>
        <td>${comments}</td>
      </tr>
    `;
  });

  // Email button with current email attachment
  document.getElementById('emailBtn').addEventListener('click', () => {
    const accountNumber = document.getElementById('accountNumber').value || '---';
    const accountName = document.getElementById('accountName').value || '---';
    const msisdns = document.getElementById('msisdns').value || '---';
    const comments = document.getElementById('comments').value || '---';
    const modSelection = modType.value || '---';
    const extraVal = extraInput ? extraInput.value || '---' : '---';

    const simSerial = modSelection === 'Sim swap' ? extraVal : '---';
    const slVal = modSelection === 'S.L' ? extraVal : '---';
    const planChange = modSelection === 'Plan change' ? extraVal : '---';
    const addonVal = modSelection === 'Addon' ? extraVal : '---';
    const tonVal = modSelection === 'TON' ? extraVal : '---';

    const tableHtml = `
      <table style="width:100%; border-collapse: collapse; border:1px solid #999;">
        <thead>
          <tr>
            <th style="border:1px solid #999; background-color: yellow; font-weight:bold; padding:6px;">Account number/Sample #</th>
            <th style="border:1px solid #999; background-color: yellow; font-weight:bold; padding:6px;">Account name</th>
            <th style="border:1px solid #999; background-color: yellow; font-weight:bold; padding:6px;">Msisdn(s)</th>
            <th style="border:1px solid #999; background-color: yellow; font-weight:bold; padding:6px;">Sim serial(s)</th>
            <th style="border:1px solid #999; background-color: yellow; font-weight:bold; padding:6px;">S.L</th>
            <th style="border:1px solid #999; background-color: yellow; font-weight:bold; padding:6px;">Modification</th>
            <th style="border:1px solid #999; background-color: yellow; font-weight:bold; padding:6px;">Extras/Addons</th>
            <th style="border:1px solid #999; background-color: yellow; font-weight:bold; padding:6px;">Request Type</th>
            <th style="border:1px solid #999; background-color: yellow; font-weight:bold; padding:6px;">Comments</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style="border:1px solid #999; padding:6px;">${accountNumber}</td>
            <td style="border:1px solid #999; padding:6px;">${accountName}</td>
            <td style="border:1px solid #999; padding:6px;">${msisdns}</td>
            <td style="border:1px solid #999; padding:6px;">${simSerial}</td>
            <td style="border:1px solid #999; padding:6px;">${slVal}</td>
            <td style="border:1px solid #999; padding:6px;">${planChange}</td>
            <td style="border:1px solid #999; padding:6px;">${addonVal}</td>
            <td style="border:1px solid #999; padding:6px;">${modSelection}</td>
            <td style="border:1px solid #999; padding:6px;">${comments}</td>
          </tr>
        </tbody>
      </table>
    `;

    const bodyHtml = `
      <p>Hi team,</p>
      <p>Please action the below:</p>
      <p>${comments}</p>
      ${tableHtml}
    `;

    const item = Office.context.mailbox.item;
    if (item && item.itemType === Office.MailboxEnums.ItemType.Message) {
        Office.context.mailbox.item.getItemIdAsync((result) => {
            let attachments = [];
            if (result.status === Office.AsyncResultStatus.Succeeded) {
                attachments.push({
                    type: "item",
                    itemId: result.value
                });
            } else {
                alert("Failed to attach current email. Continuing without attachment.");
            }

            Office.context.mailbox.displayNewMessageForm({
                toRecipients: ['qv@covalenseglobal.com'],
                subject: 'DSQ Request',
                htmlBody: bodyHtml,
                attachments: attachments
            });
        });
    } else {
        // Not in read mode or item not available
        Office.context.mailbox.displayNewMessageForm({
            toRecipients: ['qv@covalenseglobal.com'],
            subject: 'DSQ Request',
            htmlBody: bodyHtml
        });
    }
  });
});
</script>

</body>
</html>
